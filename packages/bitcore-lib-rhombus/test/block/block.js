'use strict';

var bitcore = require('../..');
var BN = require('../../lib/crypto/bn');
var BufferReader = bitcore.encoding.BufferReader;
var BufferWriter = bitcore.encoding.BufferWriter;
var BlockHeader = bitcore.BlockHeader;
var Block = bitcore.Block;
var chai = require('chai');
var fs = require('fs');
var should = chai.should();
var Transaction = bitcore.Transaction;

// https://test-insight.bitpay.com/block/000000000b99b16390660d79fcc138d2ad0c89a0d044c4201a02bdf1f61ffa11
var dataRawBlockBuffer = fs.readFileSync('test/data/blk86756-testnet.dat');
var dataRawBlockBinary = fs.readFileSync('test/data/blk86756-testnet.dat', 'binary');
var dataJson = fs.readFileSync('test/data/blk86756-testnet.json').toString();
var data = require('../data/blk86756-testnet');
var dataBlocks = require('../data/bitcoind/blocks');

describe('Block', function() {
  var blockhex;
  var blockbuf;
  var bh;
  var txs = [];
  var json;
  var genesishex;
  var genesisbuf;
  var genesisidhex;
  var blockOneHex;
  var blockOneBuf;
  var blockOneId;

  before(function () {
    blockhex = data.blockhex;
    blockbuf = new Buffer(blockhex, 'hex');
    bh = BlockHeader.fromBuffer(new Buffer(data.blockheaderhex, 'hex'));
    txs = [];
    JSON.parse(dataJson).transactions.forEach(function(tx) {
      txs.push(new Transaction().fromObject(tx));
    });
    json = dataJson;

    genesishex = 'a0000000000000000000000000000000000000000000000000000000000000000000000002c0ee0829a772341d64f3dfe4726166d903631f06029584e3945934884d7f2cda6c7bd1505e1cb877b6d03cd71019b7d5c4826ee3ec6392a1d531955c23e2f9806b8b59ffff001f2417000001a00100000000010000000000000000000000000000000000000000000000000000000000000000ffffffff4f04ffff001d0104455468652054696d65732030332f4a616e2f32303039204368616e63656c6c6f72206f6e206272696e6b206f66207365636f6e64206261696c6f757420666f722062616e6b736a00ffffffff2201d63440a2010000001976a91446a064688dc7beb5f70ef83569a0f15c7abf4f2888ac01fce41daa330000001976a9149c97b561ac186bd3758bf690036296d36b1fd01988ac011faf2e07000000001976a914118a92e28242a73244fb03c96b7e1429c06f979f88ac0177cd1301000000001976a914cae4bf990ce39624e2f77c140c543d4b15428ce788ac01bd479991150000001976a9149d6b7b5874afc100eb82a4883441a73b99d9c30688ac01c6b85af4d10200001976a914f989e2deedb1f09ed10310fc0d7da7ebfb57332688ac01b69b0d4b6c0000001976a9144688d6701fb4ae2893d3ec806e6af966faf6754588ac01e4b051c99b0000001976a91440e07b038941fb2616a54a498f763abae6d4f28088ac01ac3a95f1ba0000001976a914c43f7c57448805a068a440cc51f67379ca94626488ac018d1387503e0000001976a91498b7269dbf0c2e3344fb41cd60e75db16d6743a688ac018d1387503e0000001976a91485dceec8cdbb9e24fe07af783e4d273d1ae39f7588ac0144c6900d390000001976a914ddc05d332b7d1a18a55509f34c786ccb65bbffbc88ac0164bf8163180100001976a9148b04d0b2b582c986975414a01cb6295f1c33d0e988ac01fc192564180100001976a9141e9ff4c3ac6d0372963e92a13f1e47409eb62d3788ac0124d82728370000001976a914687e7cf063cd106c6098f002fa1ea91d8aee302a88ac0174d04b1e240000001976a914dc0be0edcadd4cc97872db40bb8c2db2cebafd1c88ac01977be006000000001976a91421efcbfe37045648180ac68b406794bde77f998388ac0189120801000000001976a914deaf53dbfbc799eed1171269e84c733dec22f51788ac01c68943281f0000001976a914200a0f9dba25e00ea84a4a3a43a7ea6983719d7188ac01e475f8211f0000001976a9142d072fb1a9d1f7dd8df0443e37e9f942eab5868088ac01cf9c695e280000001976a9140850f3b7caf3b822bb41b9619f8edf9b277402d088ac01fab8e6323b0000001976a914ec62fbd782bf6f48e52eea75a3c68a4c3ab824c088ac01867e669e2e0000001976a914c6dcb0065e98f5edda771c594265d61e38cf63a088ac017ba2c48a650000001976a914e5f9a711ccd7cb0d2a70f9710229d0d0d7ef3bda88ac018c1f5d59240000001976a914cae1527d24a91470aeb796f9d024630f301752ef88ac01981d055f190000001976a914604f36860d79a9d72b827c99409118bfe16711bd88ac011f3b5e661d0000001976a914f02e5891cef35c9c5d9a770756b240aba5ba363988ac01ccf8482c080000001976a9148251b4983be1027a17dc3b977502086f08ba891088ac012aa39eb2120000001976a914b991d98acde28455ecb0193fefab06841187c4e788ac0100b401da2324000017a914fc118af69f63d426f61c6a4bf38b56bcdaf8d0698701008a0700ef1a000017a91489ca93e03119d53fd9ad1e65ce22b6f8791f8a49870100a3c5df3f0e000017a91489ca93e03119d53fd9ad1e65ce22b6f8791f8a49870100daa532ad13000017a91489ca93e03119d53fd9ad1e65ce22b6f8791f8a49870100a09eee955a00001e04004a1f5ab175a9149c8c6c8c698f074180ecfdb38e8265c11f2a62cf870000';
    genesisbuf = new Buffer(genesishex, 'hex');
    genesisidhex = '0000594ada5310b367443ee0afd4fa3d0bbd5850ea4e33cdc7d6a904a7ec7c90';
    blockOneHex = 'a0000000907ceca704a9d6c7cd334eea5058bd0b3dfad4afe03e4467b31053da4a590000c59f30ffaf0c06f0f563e552cddf680f51f8452856a536f524c6ed730d04da506f17b43a9bc23fcd5ee746b8e9b8d4d6d2ccec5a014f67cb2b89bae21d3a4e18f0558c59b4f4081b0000000002a002000000000102c0ee0829a772341d64f3dfe4726166d903631f06029584e3945934884d7f2c1c00000000ffffffff0204090100000007b683fc010196b2d5b4120000001976a914b991d98acde28455ecb0193fefab06841187c4e788ac02483045022100a21d405cfa24718a184b1f7ac786059891ff7fa0a0b83dbb4e08387c0aef74b6022003a5a772ebf5fffaa12e32d7e9ea3b99a612a0dc191d934783d6057fbca5c48d012103148c2e8ff23c0b478fd7d5a67aac9056da7fb8ae5355be6ab9b263bb90170901a00100000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0706696d706f7274ffffffff5001979ef321040000001976a914ff979cdfa262c46116859e150b18bb23bad82c6c88ac01fb4af35b070000001976a9141c6ade6a93b9940ba5f3a83659a32ee1bbe419b988ac01b720e087190000001976a91482e3230074277860fd76a0b434dc2870ba18457f88ac01c6b5b30a000000001976a914abe88b4243ed53353e2012bc9e0a4ee5893c1d8688ac01826d7ecb020000001976a914553bbf90ffc8c8ab96ef8843fb5ff5dbfd3881a888ac01c30ca63c010000001976a914779aaa13dd0eb20490acbe39d526565dd6bc513088ac01f2db9c95010000001976a914ff680f6d366ff0fc97975c96d0a7244fca10021188ac017565f4d5000000001976a9144641ad198a00c103d1b70cada76534dbb93a4b2288ac0118f5053e000000001976a914daba4fce74b822c4a310d3250489898e90dd699a88ac0110dbbb8a0e0000001976a91406f52ecb191c316eb579c3c818deb7cdaca24dae88ac019a40e5f1010000001976a914b07062c5d15dee12b5b1fcdc6a1101fcd299974488ac0157aa7915000000001976a914753b7bec8d08866ccb1151d26da1315c0fb640a988ac01a5bf0100000000001976a9141009ca7eda18e77dced9b6bd150913825f452ced88ac0177052ace020000001976a9146205df395b15f5d2c097d65b0fa84351f92dfd2588ac015fa9e655000000001976a9142e25168ec675a1795970aae23f2b69083eaf154988ac01c395387a020000001976a9146b01ca2f4e2836afff047f999d023bc8439f9df888ac01474d3e90180100001976a914747773e17f3b35c99fc507d2328d92d4bb7de99888ac01415a67bd000000001976a91417793d06741943aace640cc99c5a6898942e978d88ac01111223f2020000001976a9144275c91ed532d82084a4f9bcd8ab091a7734c71688ac01eefbbf00000000001976a914f554fd1a7e7e4cf73e86568aa971b175ce4f2ed488ac010081700f000000001976a9143ab1b1513c8cbb7dc2e3aafee496d59e0ec7522788ac01390ece180d0000001976a914b93e954685ab8c4e957af820e41fc41a28f06f8588ac01e46fe993000000001976a91478ca579b162de911891c4fb0980c6768bafc124a88ac011939b344000000001976a914a0f7b0e61234fae8e5743bef0ec9d2c11429df1888ac0153716cc8000000001976a9141b76dd670eca71a085944b2494f92f0c0c5eef2a88ac0167ccc207000000001976a914c56b4d71ed4d7db18b0d60bad93691868cabe6a188ac01a396122b000000001976a91439ca98208a975b63f11df61392b11b09a1b378ec88ac01d12fff1d020000001976a9142fe9547c5e20aa4ef80c1e77e6237c192a6dface88ac012a8dd7a12d0000001976a914b963a6c4a043027e580439ec2c3f832d710c136288ac01d3d43334220000001976a914d6551a4addb9e876d5f6880b3f955dfc40c605e088ac0155b31707000000001976a914a71685a7435220ad1feb227f98bacb7ae915cb3288ac011c40a1a9090000001976a914c13b91c8f0b23471589584024d914854a1c8344f88ac01a1eec000000000001976a9140d4878ad650fad0d3adbee1a65e7926fe9bcc1db88ac0140f83180000000001976a9141daeb4cd1e7c5cb921d6bd9d5177f389ffd557fe88ac0175cdc934000000001976a9141f655babbc6daee5fc00f85ddd634c10b8f859a788ac01ec854614010000001976a914b86724792b91d9289e127689996eab5465d2edbb88ac0137d10b67010000001976a914b2f1638a72eac18a0b0be81955700285119f238788ac017f683cce020000001976a91410eededf60be12ba578bcec1faf246f2df4c7c3988ac010c72278a080000001976a914cc3fd4284b98727c85f9c84fa5e36aba40155ffb88ac0150b0b634010000001976a914f474f38c2a52d6e297f6e4af905eddb6656dfddf88ac01ffd1988f180100001976a91400455b888756272f4d78960ca40b0f2f577dd82788ac01937b5f09000000001976a9145264bca9259b3f28cf17c39867c11b208f360e5e88ac019b68d84b000000001976a914a56052d39fa91ff4621fcd874bfedae9aeeadc0888ac01be070bd3030000001976a914fe92d1037113939aaca3acdf040dae862c94f06488ac01f42dfbe31f0000001976a914c1f9482a9d36bb26d5763d4d46890cc4f19e348088ac01da7ed1db640000001976a9148e1186055fbce12965e4d3c6494e148b1fb3f52188ac01c144dda4110000001976a914770ce1cd15888516f4f8c5fb28651d535e59592688ac017fb182bc520000001976a9148d506e77b6c5ee07d0224c4b5152ff77eddb8d6f88ac014b9dd70b030000001976a914e0ea3f2c01623103f329039105942112ef375a8388ac01da3b6b00000000001976a914d26a79be3320b375554c9b91c00adb8f4b4999d988ac01315779db020000001976a9143241985463a379dd50d323d5fd63e2fea6dc4dcc88ac0163e93769020000001976a914ddef5b5ecc080abd688a33a1d3d58a9b87e5c0c888ac0187aa543d000000001976a914187b3114452b7673b14f1aab4f424a216ad12dc088ac017cbaa5e0010000001976a91426c43a91b9db75fd945babfc81d7b603acbed6ca88ac01c9f65d00000000001976a914164b025647e76bf59847171de1d5abe942868db888ac013f341e67010000001976a91428803ea02f5c8cd11569bbf381d286e6c92ec69288ac0184fe66af000000001976a914f6ba7d2dd6e82dd5ebfcc3d5ce19f3174cbc434488ac01ff0bfb191b0000001976a914f1ae6c8e3f85d5535d703d0cbe6b0d4edc4af59088ac010f8bf84b070000001976a914a56bb8fac8ce29c8816ad70a019c61ebea61617e88ac01ec98916f090000001976a91417c265ca99b2395fa200ec501e757632bbf9748d88ac0127578d6b000000001976a9141ead43143558e4d68fd7aa50eacb4af9f800d19288ac012f476917070000001976a914eaf4fc340ff8f891e6ea0bbfcad4ca11870273b788ac013431e691000000001976a9148962bf5b6571d0744a0e9f7778239070ef6a2d2d88ac0101afda03120000001976a914582dc8c855a264bb0ce2575d78fa9b525decc33688ac01d1e31153090100001976a9143da9bcaba0b2e3d097db6551b25df25060ea33ef88ac01b7c5a301070000001976a91422eb02d9cb5afef22f6e35f2a4b897c3743c138588ac01f74a0847040000001976a914fe559aba4b6de7288a335cdd67f7b2aa43412eb888ac01e82f7e651b0000001976a914b6452b99597ba2adbad1f47db0d94749441611c888ac017fe2ad06150100001976a914d54243772c2127ee3c4738bfe413fc063b739f5388ac01691b487d4b0000001976a914a20ccfaae76996e68c3d03edba765e9701e25fde88ac01ca4f9a9b000000001976a9144dd6af4d00a6fe5b6171882b678bacca243c8b7988ac017f0ff4e4000000001976a91484ead96ff18a7f84d778daa5240a7b7f1e058dd588ac018c21bf0a000000001976a9146037c8ce0a87302c4b1c6d13c9c209ba2dcb74d288ac0123b2690a000000001976a9143e35170df378997d92967c042f6258c7dd76b95288ac01bf54de39000000001976a9144f5621bd673ed374e741306ca02fbda1615c49a688ac012877558d040000001976a91478b7956f81d14d46d79575e8ea36df322420472a88ac0126943b0e000000001976a914d363dda2b4f890204805022b90e8baca5e63d51788ac01523cabc9030000001976a914124a82d2c99819b07ca5c435c9af9fd753bd27ac88ac012489cd24230000001976a91472124f5f08159abcbc5564557a0334d910143c1b88ac01cf8904d3000000001976a91439a8933fb50e9af0bb629085aaf1cf8fa7acde1f88ac00473045022100d9ad2db2ce7f73be53b53548373b599db33333cd2d3c345d1a5aa5756d8de3c90220617bcd3319291614ed95010eb6c3082fed262682f4ce977fb72fa2489d93f4b8';
    blockOneBuf = new Buffer(blockOneHex, 'hex');
    blockOneId = '4d02ada1afdd18eb9788874177e1d01427823a24689c6ada1986e3300180afcc';
  });

  it('should make a new block', function() {
    var b = Block(blockbuf);
    b.toBuffer().toString('hex').should.equal(blockhex);
  });

  it('should not make an empty block', function() {
    (function() {
      return new Block();
    }).should.throw('Unrecognized argument for Block');
  });

  describe('#constructor', function() {

    it('should set these known values', function() {
      var b = new Block({
        header: bh,
        transactions: txs
      });
      should.exist(b.header);
      should.exist(b.transactions);
    });

    it('should properly deserialize blocks', function() {
      dataBlocks.forEach(function(block) {
        var b = Block.fromBuffer(new Buffer(block.data, 'hex'));
        b.transactions.length.should.equal(block.transactions);
      });
    });

  });

  describe('#fromRawBlock', function() {

    it('should instantiate from a raw block binary', function() {
      var x = Block.fromRawBlock(dataRawBlockBinary);
      x.header.version.should.equal(160);
      new BN(x.header.bits).toString('hex').should.equal('1b00ed5a');
    });

    it('should instantiate from raw block buffer', function() {
      var x = Block.fromRawBlock(dataRawBlockBuffer);
      x.header.version.should.equal(160);
      new BN(x.header.bits).toString('hex').should.equal('1b00ed5a');
    });

  });

  describe('#fromJSON', function() {

    it('should set these known values', function() {
      var block = Block.fromObject(JSON.parse(json));
      should.exist(block.header);
      should.exist(block.transactions);
    });

    it('should set these known values', function() {
      var block = new Block(JSON.parse(json));
      should.exist(block.header);
      should.exist(block.transactions);
    });

  });

  describe('#toJSON', function() {

    it('should recover these known values', function() {
      var block = Block.fromObject(JSON.parse(json));
      var b = block.toJSON();
      should.exist(b.header);
      should.exist(b.transactions);
    });

  });

  describe('#fromString/#toString', function() {

    it('should output/input a block hex string', function() {
      var b = Block.fromString(blockhex);
      b.toString().should.equal(blockhex);
    });

  });

  describe('#fromBuffer', function() {

    it('should make a block from this known buffer', function() {
      var block = Block.fromBuffer(blockbuf);
      block.toBuffer().toString('hex').should.equal(blockhex);
    });

    it('should instantiate from block buffer from the network', function() {
      var networkBlock = 'a00000008d5f85d1902617d8fb9d43bcfcf665965a58f3ffd506a5493fc9bcdd134aadfa6901a31effe7c191bdfb46cf4d9f225d182445777ebbed2e06946075091e22c5499d6e198ad6787f89f3da8b3eee514cceef3487a539493605025329b25736ed3003195d782b041b0000000004a0020000000001b67ab6f983e2381b96cb3010f69f9eb447daf66c54f82838607ac1bcd1b4dcb30100000000ffffffff0204139199060007b0a5f0ca0209d086030affffff1e014c0317ef280000001976a914d6c4a2cfd1ca33a54a1bb71c6bc124b0b47c5ff888ac0247304402204ceca8e10862896d8a262330659d749064065ca2c92db65fa77ca14469ebf23d022028b82901518b0df8de1e6cbb1dfb30134389a5d829c85102e8fcf777042892490121032e0af57b2b3a4ea705216d4cf160dd22266abef179b52e50f5d0f239daace793a000909906000e08cdbb3a75a6e62a03709b409d493bba79e9173e6a7cfd0e891c4de549bc88950000000000feffffff0c6a122f33c3106ef71a9835908baadf45984739286bd7745d0a4b00887258920000000000feffffff0ddfaee8699bf4ceacf696f9b0de9dd5b127cd3e15748615b20feedc9c7e05f20000000000feffffff24874dbd973cb644b13338a9da8cd6ee03af1c8f752cb28fbd2fa3ddff9513090000000000feffffff28ff97206b463043bdcd1ed7b7cc1879bf6695cca4ed96a5ec5584ef8024afd10000000000feffffff44512f225ad66e88f0e4c990e625f22e4f42869fc6f49fb2dde5a632b1e322f10100000000feffffff452861d90086a1b67b9fbc7b6087720058acd9d2c2ad7494d6fd6aa5e60a3ed10100000000feffffffa9c82782a001a7aa4f4eb9259f5314a77b879f07c5d3c9bd7b349ac3c74c042f0100000000feffffffb80f7d105db6c972ff781bc8552992e042d60fe417a97e1fcc55c17a3103e68e0000000000feffffffbd242859c7cb7c149d83ed6cdf24ea61d54629af7f12f31bc0bce022a72e986b0100000000feffffffc0867f77d1adb90b8f44e923ee0c37613f3acde1c6e239a42e4f0b6bd8aaa4520100000000feffffffd2a65ac079dd045b1995f0cc39dc697d5437742163535c8eba4d18ced95d86230100000000fefffffff6e1f36ecdaa48e253fe7a3e9a88d35afd2ecb4767d20d7e0a604ef3716645680100000000fefffffffce418b8a22ca784a0791a9fdc96a09de1e13545e24c573cea3d08760d09dded0100000000feffffff0404040698bd1b020830b6c0d14f182b8d7f3a90b56175d3e5a8ba858c32bc5cbd194ff772d5236bee2103a5f26167efc3c689fd16b5fcc159834d89766f9854f0cb00f3d585e3c0e4eb211976a914ae5644e6dee7c24185f89bdd2196933e4197e3aa88acfda302e4a3ecc1d35abaa2ae8549d741615dd7e3e2b75164639ef4f5ef000ba575b549eb831ff8c5bba5ca9a6044a819cdf61c735fb26bff6fb39ca1f07ed5838c67d70da09f201d31e29dedff6d20e7fbc503e79644d59e6059051893b1eede63aacaef4b29d3095990e3628a497e048cae4d2c719fcecd7217a2fc68d04911bfda80ee72f92005ae86b0f3e90b8a45359542ab1040420879d23040c410749026283182e5914acb769549f70cdb47d9ed28efbf6ce7c8aa8f30cc0e83aa25c4a467d976c4292e47d535dc1acf8818889da9fdbf39160ebf29011c687321949ea6f52edf8e411c9eadc2a5342fb8623676459fbc3b31d9eb67683719b786aeea7956eda32aadfa07c0264ecd2296f39424c0fed74de9bdf40fb007f4e0c02d601a4f9c373185be38b7230ce5043e40fc1e9c3508881da131e34e5ea446f0843fecdb073ea82ce53414f40d43ecc9803e68fdc24f2f17210e1940e68444dcfdcb006ebb3b2e00a4a372bb86b80e5b9ec5c71055e94941f7465c076e7b5f3f9ddba7cb7ea29a5e1e8f7307e3d22cd66ff6a10fb3c4469aae0a2b359304c1e5264941d00b28e01128416179ac862cca7b1d64c17e707b3b653e48d14da47ea107ab1710e3cb43e9e907c5b4e2465193895f8fc4524f1fc5123aabb7cf8413b33d3f658e4bd1b07fb755097b0f1c5a12e4bc1c1ddf8675e86a89176d3c7ff911eda9e1d883335be2557e5823ea37c13b259ccc49584574a7c62f987a269607e7776811c1e82bb32052edd4fdb11a0478937661bbcff2e7f8c4338195d3b9cbdb8bd72b3b78e058ffe4b777f2f4cdb66140931f307cba2b3562a91a51a1db931bb9e2fe7223caa95d0cdcb15924e9de7e5fa684de8b17323cfecf12d6ce37eef23b8eb8e52aeed8ced28baaf0734b88832330970caea69b489c7840c594045fa309e33883cb4b42f201988f0f00000000001976a91406968cf03d828f52b93d49b596a9d426f268397c88ac0209e2cbacd334a0708366e0e2344e6fd489d18d9e370e423c00efe0f029f0d1c81c210375a00d5df931b4b1d20e61f9cd7a843685e6b6aa3beaf22b787903e2b227ba551976a9144da641536c6d667a10b1dfdf996bb80fb4ebc8f488acfda302ae8b6035a8b650a74b422a9f0ec8c947bb5ce0044a529dce1c1d251458a0c0a4b096b4527eb39d09f15bd21528a425e435d4b0f51a2e300140d766e704d383a7076a7bb7bc30a17ba4764320368ffa0cd1b7e16e93488688a9ae3bcb4da2da2b387d71f612e327c8f67c78741caa4ee95403fd48b8eb0faba2fdb32bb1df5ec7d7d6b4333ac92af5d3752eedb80b85fff1cd733c88ca44e3af873221889b1e6c967b78a2a7a66b87b26c76919b8f917942252750e72b983f2ae40d9413d5d6ad3aa00167d568b1745804f8d540f16af9b8990cd5fd670e7863abcec3fec1b902156f22766de2470dfd0a1910119c22759629d3416fa2239ffd01014c50442df85b4bd58ef4a70cad2a2cd55085a68f46d9e1bd55db5ea01b5336bb06a593476080d6171b41332b71c8a8613329fb7a4f96441e8ca88030f1118ac8284341cd9cff95f5a2e723b1ce4efb9bae0f5d0e19f30dfb17f9bb773eee7f90f001f913e7f79001c58f83704b21909c7c01e5bdb62cfe79ba6cd44708009787185d646c29b4f4dae70d9cb232121829dfbee3e1d19aeb99bf5de0a30d7fbac9f9ec92f53a7d38b63533f83125809fcedc320c791df399640d3b48fcd336d35aab35c0d8a7c82ce6380053e040a8aab31bf64ec9bf691b36cf179f1b1097a9cf97b7ec6711064a4e5efb647340fa42a32a9660bb60d7ae1227eb2b07aa84ee2b5e3a401e38f42dfc714adea78b06ea5290625a6ff1d714b3b42b27a5e2cf46166efe44b3bacf3ce5bcd22606edaf3c0a4878cdf221f567acbd3de323e7e0ec4d1b9e707dce8503cc2e3fbec04e36d53eb8fed67bc8f9d8f136e338d98e31b250437e1787ab03fb52509e5e28519249092591b8398d1c4a912760a68fb713abcd1bd3919993e9441990c41e21557b64f3afff309e5c03a8df777c81fbf9a0784b38171b3044bdff770247304402202790c13a8e1cebeb5b471fa16d7629701b40e6dd542393d378ad0725f80c824702200f5af7e4b0ba6ede39601ce5c2b88369b6e86f2c585311db7dd35fc256c80b55012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c1024730440220157bfd7318faa49247a1250f71d52da6e0ea8ea9abfc3ded5af7307e634831e702207b5eea9abb0b02ca591b8a37992fce1a1fbbfff7456d64389792e947e6e6b588012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c10247304402205295129143df9b2d20c188b60c983ec428752211868bdb5d4d8e2356bc65b956022021300f1729e4f6d2422789f460124bd77afa8a53be7565a6832225e5ca36ea94012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c10247304402201c045718da2c3a56e32c8f74a69fccdb39b703e99c0255a9770b5dba63d5d60002200ab21ae366db17ceae9f2923bbe539e38e492544ea3cae7d67be25b6c85aa70c012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c102473044022009bd9d51b4fee2f1fc39e72092628e42821a6ae55e005e0e47d0a42e627b0a08022051e6f785cd6dfeabe8a88706274daa9df30f7947ddec20fb68d2e05469cac269012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c10247304402202964cee092906cbc86c08e0a1c83c25904f40dbd4f14a048dc6c96cf7b0890ad02200c20ee743fd0ac6bd95e99b8b99b0c45c046d5f0ec41a84d861a47d8f772d73c012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c10247304402207c401febe935ca45b77e2bbafcaedc12177721794a5238961f00a0830d682283022068560f4b5698ab4b16e612fd9d2729936760ee6901aa5f4e7a9a434f99abf9c1012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c10247304402204ecd5f800e99950365fdd90935df64f72aa841935347368edc5eb00e3fe1cb4602204ef306eb938cdb3da0ce0e317f6a3718ef2e6702e9fd2fb9b27985edb4e4382c012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c102473044022062dd0ab7ec20a9fca0427b095cd16f73f58aabcff764382220bd502f039b05680220231aa9244fdb89b5052bd084a2b271cf601c004c9794a77ba12ef5917d1e3fe9012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c10247304402200cd6b29e302eb13eaae3ae280d40b4b49ee42bcce3fd1c375973afa62857dccc02203c53929cd24cd3361aaaa0e34d01d816b829e31e68e19d0b448cb00f9aca139b012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c102473044022069f39727fb414461a14c9e00a4403244c9b7a7986c72791f0c67a677019b2528022024b4eadbbf70fe62eee273f3bd69e603f257604175bbb7a2eb2827c274d3a57d012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c1024730440220414c53eeb84383c7b957cbcf0488ff0d5fe92c343ad402b6afbd0f55053e84b202201d5eae433773c7feba31bb15dd9f2656ddc90df90eadcd775cff9001518ca0eb012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c10247304402204a73d3d9f94fc0957cd980d3be852c5445f963fcfe3e4eca0b546a78796170d6022072cbb6fd2b9892b3151292301e38ce474a4c9b778a1feade66f15c9f88e1094b012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c10247304402202b609090fc9676453af0de5e25e137d8820ec57e9c9ea98d0d84367888e0694b02203326a4517f4551f003147f0b4321ba9e8002a0e29b9781789644929367a90742012102f69f3847f21a82f5d7f466b39f3dd9351c7fb7942ead1194a81e1d79be55e8c1a00090990600012ad37190b466eba33e409bf8cf01ff754718177d25a8ecd3a2106646a5b84d320100000000feffffff03040406e8fc0b02083412b48e1c398c8524776b46aa6f3a2ce52160bb570b27c500aa1387be0cf98521020c20969d98714d4e60132f537db1e7baa3ee963d10fdcfc34b647cd10e16e1cb1976a914e27bd163429ec1b0fe42f223fdd390747ec4871088acfda3028379cd193e2b2e3da8f29a109f3a28191b2272a7805f78b193e09e5a12e936a010eb1f2e44acb784b6e5a8a220c9c42f6f063a9c08f1b9b50c673e7e7933f34c04bd4cfb6b3597bed6827a02dc3b188396ec35913c409223da4d1e9d9dfd92f41351ca897d57f1fded7cafdcdcf66f95053ef2a47108585bbe85adb1b0c6320ed4fb39a0f5f6db198c93c736a2833d38d776df3fa1bde16ad8fd4f83acd9a2e6b0d8da93dc18276f51df42ffb33f3321fa6e7b64b42e692544e2fe152511e61bf3c3461f65d383b0f0789dec3961f4e3a8102858a9ad9d4e3c92b686cd791339fcaab757c6316e3bf5b3d74c91e5219dbe8e13c26d57751947b84f6a89d40326028d3c0bad94c57e85ab78b7263976e44375d913d06e2fc6d0c229c4da261ce996f8416f563c44ebfbf106c77a43736e530f016e99c6c53cc345307350e7448d01227552ae06fdbcdc16fdbc93e22fe60ab96a448739d2618d3293601a3c5e2e885803c14b665c5aec5f12f51983f7a984fa18ba13262a43d7c1e0229abf002994c98be9a4d8c1e044a8b2c877d35824085111c901016f2bc514ac98a852b7aa2bd6828e9d4e3fb2384305f4f08d2338050b8cec41a213c133cd8a78a570bd8a4566a0fed0a56617ba1a099ae94e9da0ae94a562e745c210104c8a31a35d5143e436f55dbfdbd324b9ee6170ba5463828a8ea79ccb66f4d2b46c072330440a32d80aefcd72805c227f8cef69003de184dbeb362c7bd9f1660742a6692006216917a76f93ef3f8aeb3eacfff22b0e51b44c6ab0f35bd32ed83a5c757d07ab24e55288dc71d0edc2a3b47ecc1a6d673171e1e2f92f8c6527bff7b5c785aa417a6237ce0dd2faf09165a4a01ae9363e063f0d217da8097575e658281a62a1cbdcf5ce53d519a7834ae9560affad8f1f60bc3481424e48737ef9d4d5ec73daf8b0226f49c20209486a4b2e4db601d9f71f46ba36599614f5436ceedfe53be3c8b040747e3881da2102208c5a8a287c791827586ccd543b970eb1da480dcea5b2f54c8917628bdc76ec1976a9146f4e33955662d88024a0a4c7d67972bf05954edf88acfda3021535a08e2ff3cedcac9fc64e10eaa4b02539253c8d17144424e76d05fbf5305c471a9b1520ac7f2e49b2b70d50f57d5fff0d5cc45d700c316d6d568624f9179e0a06978e36f943e06c3e578d1dd5ee7df651ba2ec97c4e16fcada42ef8c872582bc78809fa45ec8bd97f9e872b91a723893a1796d3d2be43d2d762ab63a195114e3a7f1c19e5897db906ab3b4fcf877a75c47e8e1d64d902644ea4646f1b0302fba6c973680c49df74cbdf633b13a8fe0cdfca18d62b1c45b94a776fe663be264475ff7de3935254391acfccff9f36f94ebd6a4058d2413a1ed80110a7aae2f4a6d705d70a8e741a6449041f1f98fa67e1c98802083ba2f573cf7340adaad5024f968ac363d005133e62187d3181cd0cc6c2eb9cc8c069fe9f72599e088054d42f9cd3dd0261d4c1922663a19adaa26abbae8d94f388a2c78dced7b4caa92deb92ad4a4db46518c34ec182fd055080e9df9b7c687e738175684639bc8d7f2fcc03460259abb99790baa37100a01ff3059cb777fde0ce12efce9c44e8718244d4ba32936be53fc39e078415b4694973457c6106866a1b24ea812320ab396912956ca44b2e2e9b81dc9b70c917dce67f4796346b5d651120aa6af9c6cf9c927b6c04f7c34b53aa80726fa1c45af08aec34ddd7a4907182f8b9683fbd3c4dc6b2096a4dbdf2aee965fbd299e850cff109299c231ecbaf7dbf78e42c22cd2fa0cf6c7816d60eab95dfd31f0297082b67c0dad608d3dfdf6f861fdad64554648e98584352f6a58376bb52da96ac8f94691f0ab17d2f41bbd52adafcd6d8231a21b877a13ee6ca0ce7456f9c9bea3e66e7695d7fe3a5450c51e06f5b216e28d32701a9fb82bb0a9c7fcf8e950c7f5d34d09b6a44464e569c64fc0ea61fadb49eb756727aeb7d78a247337bebf65a101a6e02aa8eaf3ac327e21eb1be251ad359ba817a028f320247304402206ec66fb76bedeb2afef77cb36d688dcc76e88eddab5d9035e29c12febbf33c8702201f1aef7878b7e7d247f7999fdf5bd392c4256131743d50b402e3c5f0aee036cf0121034af8ad8f05ac8d1f82b6c193aa8b1eab4ad7f3ec966f5fbaff68983e7f214145a00090990600012ad37190b466eba33e409bf8cf01ff754718177d25a8ecd3a2106646a5b84d320300000000feffffff03040406e8fc0b020839601d26e04a67cd8e745e50eade9ceaf51690135b0d5838c4a1c4f998f5b57b210339e93e91d54d0c1e166ee24b5f1501484df760359df3eb8ad910f4c2809c64bb1976a9144d1096ce469a6a471a930cddf074726b783eb3e788acfda302dfbc0e487ad7a83a4d56cb0b6610f3cc942c066fd076eff70f8d0103695b4a0b10a332c84be6262ded87b06afe5344fc0988bff6fa4b940e70e3098ef233dd5004a4a2200cd85bd81257de8134406e23634f4c365d667877c2d3659e96ee6ea13887145d9e296653abf77811a92b976550721d223a7db4ddfe3afddca083b11855dcc2e6135f4a7ca9252e4a42069ec49d51e95227b0333d43e00d39ef26ba797a9faa223f3bb367a7fd15f5fe8617e43ae2ecb1d1da162f18f6af6317958a3cf50a2efe5cb78b414b57795e2b32e107357ee76cc56359a094cf2813b7d7575bef3d71810302ac76106633ce1a65cd4ae11d8111c3d96f65950b497506c71a5aabc4d176ebc124c18a786cb03f104c78025ce7bee175e72ffa2bc4d6da98e634c38b834f138d9699c9610cf7d51f2eeb4ac0788b7967cd64b94a9f88fccce8d268ae3572a4286e41b39ac8972f54da5573a4880ec859df46cd5e27a1bc252581917d03ee2a1318aaea9d58a69e876e3bf4ea08d745f4b3315c2f8eb18e06855b7953d3165d73f2762f02a87595c4807e50d52cd7009fddd5c5018aec74fa1082f64d93f20ad44a2d08394efaa12c1e6d93454a001ecd46a0557c7b38a3bc6890a427e130125ca62eba49d70921a73d699a700510ed104affe047c2c48a72730f71756ee9d071811ec9ba8c6b353f44b1a045c26bd2979004c1afa174533bf90af9c9bfd0c705c0a229aef54bdd65e3ce902279bd579dedec1ca654130f5267bf04d365e9a973238a1de191859e61b2ca4d85021841e222aff36338b40eb5f80b3d569991026351431dc1a3c525456613e9b8151d365120a1dbde4559f1dc1f67bd087f3fe708767403a7104edad80815045421e92821b2531fe863fdf1af38bfd9c8378048ecb3c5ee83c09d59a6aaa646825a04f70a8d59846e14423b18ddb750bfcd02087679c1dab3c82d8c2c7cfe597760d478f3d92730e52c42384faca1fead8ee7ec210359f537784ea9b7cee2cda8a9bb0a43222995e98eef07dce058661608fb40bf461976a914f650f0af61d633efb05fe5178c62f0fdffb43d4788acfda302e788d17c2e6776eee0b76020ac54a5214a3c835aac385c21180b226071cadf5348ae20e468ef37a46c8ff92e88fd969bba809c11e9168799f9987ae902b4f66608f47923ad4a514060d6463764ad1d3426b56cc041811b0821dca6c720e22878f4e586e0499413f161b9e25367838e491a33e33293f89ec763edbb082f3e307346916ca3a56214c6d9bf9a6ec22e1b2a38d18b2b9a49c793c9392fb456fcb8ad6dfd972d52ad4020bd7a2085731067dbcf25cc1e4e0e7f9e41e097505df3fed2a4cdd5280949b7db11ccfeb05916b9171a78e839be9eba62bb25b45e82afefabb4b2c73361ab3a7d93487caa426e81b644e4d82f6f0c87a7fe54f3b02a90687d98c6e8c8618d99aa7103e9b3ea8ab0d14d3e96b79f266510667221e8d827bbeb9a953fd7ac86593a641e785685f1f2b1804f0b42a164ce7ccd5e1db54b90fca832341f91e1eb3b74312a77062c67e0d086e802d83f14924ddf2f7a18005718f39fd9024419c09cb8b60427447feb215648850cbcf83af1dee48f2d9975ecf4ad8162a4ef927eebf586afa9b81471f809d7de85b8d99d8523526e135dd8642013fc3d71640979c9cbe2822f2e73be90ed5360e8b2f23b41d5fd7476060a957cb2c16ec6571e2b745ee01f976646664992e0c70b9f301dc18b8db213f1c349464395c88873a101c00d17611eb70c4cf6437aa86d1379ba2636cc983fb8e051e4786bb34da91fbe2bf37318ae8c3cd34938472161d5adba8bd32cae190931ccb8cf77854b3fafb191c6b33f417d3563c3058cd7f82895fe8c2d8220261822c66a7820f6640ea3f713462c78543da25e7c06cf79ffbb8942ebdcba95fa6de4b253e7a4aef0aeb7c5a688d612ac61b958ac4b4adc8da59ff140d95bcb1c0d82260fa9946e3f8d5a088dfdda9152380d973dcaf405410c97763ed58b0b7ad4b87fe08d0f689802473044022037db889efc64e8a6377a9da0bed5c83d9c866b9d1ad10a8650133f20bf37c6be02204d6a02c968114aec56ec8049b00e6c0a8d1d7e44ea667db364ccddfb64b8f646012103486e6fb7e5378747ef6937070d46ebc1044e024b67ca2c8ca0d8bd280319440d463044022048827c5ec06080b246f4c7ac8399599e233acde605c210b686da5ae5458f605002202b41d6f218326bae3abf15eb0d253e0a0577ef02753f5f5c9c61929cc4434833';
      var x = Block.fromBuffer(networkBlock);
      x.toBuffer().toString('hex').should.equal(networkBlock);
    });

  });

  describe('#fromBufferReader', function() {

    it('should make a block from this known buffer', function() {
      var block = Block.fromBufferReader(BufferReader(blockbuf));
      block.toBuffer().toString('hex').should.equal(blockhex);
    });

  });

  describe('#toBuffer', function() {

    it('should recover a block from this known buffer', function() {
      var block = Block.fromBuffer(blockbuf);
      block.toBuffer().toString('hex').should.equal(blockhex);
    });

  });

  describe('#toBufferWriter', function() {

    it('should recover a block from this known buffer', function() {
      var block = Block.fromBuffer(blockbuf);
      block.toBufferWriter().concat().toString('hex').should.equal(blockhex);
    });

    it('doesn\'t create a bufferWriter if one provided', function() {
      var writer = new BufferWriter();
      var block = Block.fromBuffer(blockbuf);
      block.toBufferWriter(writer).should.equal(writer);
    });

  });

  describe('#toObject', function() {

    it('should recover a block from genesis block buffer', function() {
      var block = Block.fromBuffer(blockOneBuf);
      block.id.should.equal(blockOneId);
      
      block.toObject().should.deep.equal({
        "header": {
          "hash": "4d02ada1afdd18eb9788874177e1d01427823a24689c6ada1986e3300180afcc",
          "version": 160,
          "prevHash": "0000594ada5310b367443ee0afd4fa3d0bbd5850ea4e33cdc7d6a904a7ec7c90",
          "merkleRoot": "50da040d73edc624f536a5562845f8510f68dfcd52e563f5f0060cafff309fc5",
          "witnessMerkleRoot": "184e3a1de2ba892bcb674f015aecccd2d6d4b8e9b846e75ecd3fc29b3ab4176f",
          "time": 1502369264,
          "bits": 453571764,
          "nonce": 0
        },
        "transactions": [{
          "hash": "e9a6ab0938a226e6f81823cb370b4ea16a62c54c096d1e33133225b223099587",
          "version": 672,
          "inputs": [{
            "prevTxId": "2c7f4d88345994e3849502061f6303d9666172e4dff3641d3472a72908eec002",
            "outputIndex": 28,
            "sequenceNumber": 4294967295,
            "script": "",
            "witnesses": [
            	"3045022100a21d405cfa24718a184b1f7ac786059891ff7fa0a0b83dbb4e08387c0aef74b6022003a5a772ebf5fffaa12e32d7e9ea3b99a612a0dc191d934783d6057fbca5c48d01", 
            	"03148c2e8ff23c0b478fd7d5a67aac9056da7fb8ae5355be6ab9b263bb90170901"
            ],
            "scriptString": ""
          }],
          "outputs": [{
            "type": 4,
            "satoshis": 0,
            "script": "",
            "data": "0100000007b683fc01"
          }, {
            "type": 1,
            "satoshis": 80343315094,
            "script": "76a914b991d98acde28455ecb0193fefab06841187c4e788ac"
          }],
          "nLockTime": 0
        }, {
          "hash": "915c57b8d91940877c509e139bb8461bbaf19206b1e2a985f40e2023bec2db91",
          "version": 416,
          "inputs": [{
            "prevTxId": "0000000000000000000000000000000000000000000000000000000000000000",
            "outputIndex": 4294967295,
            "sequenceNumber": 4294967295,
            "script": "06696d706f7274",
            "witnesses": []
          }],
          "outputs": [{
            "type": 1,
            "satoshis": 17749483159,
            "script": "76a914ff979cdfa262c46116859e150b18bb23bad82c6c88ac"
          }, {
            "type": 1,
            "satoshis": 31607442171,
            "script": "76a9141c6ade6a93b9940ba5f3a83659a32ee1bbe419b988ac"
          }, {
            "type": 1,
            "satoshis": 109653794999,
            "script": "76a91482e3230074277860fd76a0b434dc2870ba18457f88ac"
          }, {
            "type": 1,
            "satoshis": 179549638,
            "script": "76a914abe88b4243ed53353e2012bc9e0a4ee5893c1d8688ac"
          }, {
            "type": 1,
            "satoshis": 12003995010,
            "script": "76a914553bbf90ffc8c8ab96ef8843fb5ff5dbfd3881a888ac"
          }, {
            "type": 1,
            "satoshis": 5312482499,
            "script": "76a914779aaa13dd0eb20490acbe39d526565dd6bc513088ac"
          }, {
            "type": 1,
            "satoshis": 6805052402,
            "script": "76a914ff680f6d366ff0fc97975c96d0a7244fca10021188ac"
          }, {
            "type": 1,
            "satoshis": 3589563765,
            "script": "76a9144641ad198a00c103d1b70cada76534dbb93a4b2288ac"
          }, {
            "type": 1,
            "satoshis": 1040577816,
            "script": "76a914daba4fce74b822c4a310d3250489898e90dd699a88ac"
          }, {
            "type": 1,
            "satoshis": 62457109264,
            "script": "76a91406f52ecb191c316eb579c3c818deb7cdaca24dae88ac"
          }, {
            "type": 1,
            "satoshis": 8353300634,
            "script": "76a914b07062c5d15dee12b5b1fcdc6a1101fcd299974488ac"
          }, {
            "type": 1,
            "satoshis": 360294999,
            "script": "76a914753b7bec8d08866ccb1151d26da1315c0fb640a988ac"
          }, {
            "type": 1,
            "satoshis": 114597,
            "script": "76a9141009ca7eda18e77dced9b6bd150913825f452ced88ac"
          }, {
            "type": 1,
            "satoshis": 12048794999,
            "script": "76a9146205df395b15f5d2c097d65b0fa84351f92dfd2588ac"
          }, {
            "type": 1,
            "satoshis": 1441179999,
            "script": "76a9142e25168ec675a1795970aae23f2b69083eaf154988ac"
          }, {
            "type": 1,
            "satoshis": 10640463299,
            "script": "76a9146b01ca2f4e2836afff047f999d023bc8439f9df888ac"
          }, {
            "type": 1,
            "satoshis": 1205010844999,
            "script": "76a914747773e17f3b35c99fc507d2328d92d4bb7de99888ac"
          }, {
            "type": 1,
            "satoshis": 3177667137,
            "script": "76a91417793d06741943aace640cc99c5a6898942e978d88ac"
          }, {
            "type": 1,
            "satoshis": 12652319249,
            "script": "76a9144275c91ed532d82084a4f9bcd8ab091a7734c71688ac"
          }, {
            "type": 1,
            "satoshis": 12581870,
            "script": "76a914f554fd1a7e7e4cf73e86568aa971b175ce4f2ed488ac"
          }, {
            "type": 1,
            "satoshis": 259031296,
            "script": "76a9143ab1b1513c8cbb7dc2e3aafee496d59e0ec7522788ac"
          }, {
            "type": 1,
            "satoshis": 56250732089,
            "script": "76a914b93e954685ab8c4e957af820e41fc41a28f06f8588ac"
          }, {
            "type": 1,
            "satoshis": 2481549284,
            "script": "76a91478ca579b162de911891c4fb0980c6768bafc124a88ac"
          }, {
            "type": 1,
            "satoshis": 1152596249,
            "script": "76a914a0f7b0e61234fae8e5743bef0ec9d2c11429df1888ac"
          }, {
            "type": 1,
            "satoshis": 3362550099,
            "script": "76a9141b76dd670eca71a085944b2494f92f0c0c5eef2a88ac"
          }, {
            "type": 1,
            "satoshis": 130206823,
            "script": "76a914c56b4d71ed4d7db18b0d60bad93691868cabe6a188ac"
          }, {
            "type": 1,
            "satoshis": 722638499,
            "script": "76a91439ca98208a975b63f11df61392b11b09a1b378ec88ac"
          }, {
            "type": 1,
            "satoshis": 9093197777,
            "script": "76a9142fe9547c5e20aa4ef80c1e77e6237c192a6dface88ac"
          }, {
            "type": 1,
            "satoshis": 195988786474,
            "script": "76a914b963a6c4a043027e580439ec2c3f832d710c136288ac"
          }, {
            "type": 1,
            "satoshis": 146904700115,
            "script": "76a914d6551a4addb9e876d5f6880b3f955dfc40c605e088ac"
          }, {
            "type": 1,
            "satoshis": 118993749,
            "script": "76a914a71685a7435220ad1feb227f98bacb7ae915cb3288ac"
          }, {
            "type": 1,
            "satoshis": 41500622876,
            "script": "76a914c13b91c8f0b23471589584024d914854a1c8344f88ac"
          }, {
            "type": 1,
            "satoshis": 12644001,
            "script": "76a9140d4878ad650fad0d3adbee1a65e7926fe9bcc1db88ac"
          }, {
            "type": 1,
            "satoshis": 2150758464,
            "script": "76a9141daeb4cd1e7c5cb921d6bd9d5177f389ffd557fe88ac"
          }, {
            "type": 1,
            "satoshis": 885640565,
            "script": "76a9141f655babbc6daee5fc00f85ddd634c10b8f859a788ac"
          }, {
            "type": 1,
            "satoshis": 4635133420,
            "script": "76a914b86724792b91d9289e127689996eab5465d2edbb88ac"
          }, {
            "type": 1,
            "satoshis": 6023794999,
            "script": "76a914b2f1638a72eac18a0b0be81955700285119f238788ac"
          }, {
            "type": 1,
            "satoshis": 12049999999,
            "script": "76a91410eededf60be12ba578bcec1faf246f2df4c7c3988ac"
          }, {
            "type": 1,
            "satoshis": 36677579276,
            "script": "76a914cc3fd4284b98727c85f9c84fa5e36aba40155ffb88ac"
          }, {
            "type": 1,
            "satoshis": 5179355216,
            "script": "76a914f474f38c2a52d6e297f6e4af905eddb6656dfddf88ac"
          }, {
            "type": 1,
            "satoshis": 1204999999999,
            "script": "76a91400455b888756272f4d78960ca40b0f2f577dd82788ac"
          }, {
            "type": 1,
            "satoshis": 157252499,
            "script": "76a9145264bca9259b3f28cf17c39867c11b208f360e5e88ac"
          }, {
            "type": 1,
            "satoshis": 1272473755,
            "script": "76a914a56052d39fa91ff4621fcd874bfedae9aeeadc0888ac"
          }, {
            "type": 1,
            "satoshis": 16425617342,
            "script": "76a914fe92d1037113939aaca3acdf040dae862c94f06488ac"
          }, {
            "type": 1,
            "satoshis": 136968875508,
            "script": "76a914c1f9482a9d36bb26d5763d4d46890cc4f19e348088ac"
          }, {
            "type": 1,
            "satoshis": 433184669402,
            "script": "76a9148e1186055fbce12965e4d3c6494e148b1fb3f52188ac"
          }, {
            "type": 1,
            "satoshis": 75780408513,
            "script": "76a914770ce1cd15888516f4f8c5fb28651d535e59592688ac"
          }, {
            "type": 1,
            "satoshis": 355349999999,
            "script": "76a9148d506e77b6c5ee07d0224c4b5152ff77eddb8d6f88ac"
          }, {
            "type": 1,
            "satoshis": 13083581771,
            "script": "76a914e0ea3f2c01623103f329039105942112ef375a8388ac"
          }, {
            "type": 1,
            "satoshis": 7027674,
            "script": "76a914d26a79be3320b375554c9b91c00adb8f4b4999d988ac"
          }, {
            "type": 1,
            "satoshis": 12272097073,
            "script": "76a9143241985463a379dd50d323d5fd63e2fea6dc4dcc88ac"
          }, {
            "type": 1,
            "satoshis": 10355206499,
            "script": "76a914ddef5b5ecc080abd688a33a1d3d58a9b87e5c0c888ac"
          }, {
            "type": 1,
            "satoshis": 1028958855,
            "script": "76a914187b3114452b7673b14f1aab4f424a216ad12dc088ac"
          }, {
            "type": 1,
            "satoshis": 8063924860,
            "script": "76a91426c43a91b9db75fd945babfc81d7b603acbed6ca88ac"
          }, {
            "type": 1,
            "satoshis": 6158025,
            "script": "76a914164b025647e76bf59847171de1d5abe942868db888ac"
          }, {
            "type": 1,
            "satoshis": 6024999999,
            "script": "76a91428803ea02f5c8cd11569bbf381d286e6c92ec69288ac"
          }, {
            "type": 1,
            "satoshis": 2942762628,
            "script": "76a914f6ba7d2dd6e82dd5ebfcc3d5ce19f3174cbc434488ac"
          }, {
            "type": 1,
            "satoshis": 116399999999,
            "script": "76a914f1ae6c8e3f85d5535d703d0cbe6b0d4edc4af59088ac"
          }, {
            "type": 1,
            "satoshis": 31339350799,
            "script": "76a914a56bb8fac8ce29c8816ad70a019c61ebea61617e88ac"
          }, {
            "type": 1,
            "satoshis": 40526518508,
            "script": "76a91417c265ca99b2395fa200ec501e757632bbf9748d88ac"
          }, {
            "type": 1,
            "satoshis": 1804424999,
            "script": "76a9141ead43143558e4d68fd7aa50eacb4af9f800d19288ac"
          }, {
            "type": 1,
            "satoshis": 30457546543,
            "script": "76a914eaf4fc340ff8f891e6ea0bbfcad4ca11870273b788ac"
          }, {
            "type": 1,
            "satoshis": 2447782196,
            "script": "76a9148962bf5b6571d0744a0e9f7778239070ef6a2d2d88ac"
          }, {
            "type": 1,
            "satoshis": 77374074625,
            "script": "76a914582dc8c855a264bb0ce2575d78fa9b525decc33688ac"
          }, {
            "type": 1,
            "satoshis": 1139560014801,
            "script": "76a9143da9bcaba0b2e3d097db6551b25df25060ea33ef88ac"
          }, {
            "type": 1,
            "satoshis": 30092281271,
            "script": "76a91422eb02d9cb5afef22f6e35f2a4b897c3743c138588ac"
          }, {
            "type": 1,
            "satoshis": 18371594999,
            "script": "76a914fe559aba4b6de7288a335cdd67f7b2aa43412eb888ac"
          }, {
            "type": 1,
            "satoshis": 117666885608,
            "script": "76a914b6452b99597ba2adbad1f47db0d94749441611c888ac"
          }, {
            "type": 1,
            "satoshis": 1189817999999,
            "script": "76a914d54243772c2127ee3c4738bfe413fc063b739f5388ac"
          }, {
            "type": 1,
            "satoshis": 324224424809,
            "script": "76a914a20ccfaae76996e68c3d03edba765e9701e25fde88ac"
          }, {
            "type": 1,
            "satoshis": 2610581450,
            "script": "76a9144dd6af4d00a6fe5b6171882b678bacca243c8b7988ac"
          }, {
            "type": 1,
            "satoshis": 3841199999,
            "script": "76a91484ead96ff18a7f84d778daa5240a7b7f1e058dd588ac"
          }, {
            "type": 1,
            "satoshis": 180298124,
            "script": "76a9146037c8ce0a87302c4b1c6d13c9c209ba2dcb74d288ac"
          }, {
            "type": 1,
            "satoshis": 174699043,
            "script": "76a9143e35170df378997d92967c042f6258c7dd76b95288ac"
          }, {
            "type": 1,
            "satoshis": 970871999,
            "script": "76a9144f5621bd673ed374e741306ca02fbda1615c49a688ac"
          }, {
            "type": 1,
            "satoshis": 19551057704,
            "script": "76a91478b7956f81d14d46d79575e8ea36df322420472a88ac"
          }, {
            "type": 1,
            "satoshis": 238785574,
            "script": "76a914d363dda2b4f890204805022b90e8baca5e63d51788ac"
          }, {
            "type": 1,
            "satoshis": 16268344402,
            "script": "76a914124a82d2c99819b07ca5c435c9af9fd753bd27ac88ac"
          }, {
            "type": 1,
            "satoshis": 150941305124,
            "script": "76a91472124f5f08159abcbc5564557a0334d910143c1b88ac"
          }, {
            "type": 1,
            "satoshis": 3540289999,
            "script": "76a91439a8933fb50e9af0bb629085aaf1cf8fa7acde1f88ac"
          }],
          "nLockTime": 0
        }],
        "blockSig": "3045022100d9ad2db2ce7f73be53b53548373b599db33333cd2d3c345d1a5aa5756d8de3c90220617bcd3319291614ed95010eb6c3082fed262682f4ce977fb72fa2489d93f4b8"
      });
    });

    it('roundtrips correctly', function() {
      var block = Block.fromBuffer(blockOneBuf);
      var obj = block.toObject();
      var block2 = Block.fromObject(obj);
      block2.toObject().should.deep.equal(block.toObject());
    });

  });

  describe('#_getHash', function() {

    it('should return the correct hash of the genesis block', function() {
      var block = Block.fromBuffer(genesisbuf);

      var blockhash = new Buffer(Array.apply([], new Buffer(genesisidhex, 'hex')).reverse());
      block._getHash().toString('hex').should.equal(blockhash.toString('hex'));
    });
  });

  describe('#id', function() {

    it('should return the correct id of the genesis block', function() {
      var block = Block.fromBuffer(genesisbuf);
      block.id.should.equal(genesisidhex);
    });
    it('"hash" should be the same as "id"', function() {
      var block = Block.fromBuffer(genesisbuf);
      block.id.should.equal(block.hash);
    });

  });

  describe('#inspect', function() {

    it('should return the correct inspect of the genesis block', function() {
      var block = Block.fromBuffer(genesisbuf);
      block.inspect().should.equal('<Block ' + genesisidhex + '>');
    });

  });

  describe('#merkleRoot', function() {

    it('should describe as valid merkle root', function() {
      var x = Block.fromRawBlock(dataRawBlockBinary);
      var valid = x.validMerkleRoot();
      valid.should.equal(true);
    });

    it('should describe as invalid merkle root', function() {
      var x = Block.fromRawBlock(dataRawBlockBinary);
      x.transactions.push(new Transaction());
      var valid = x.validMerkleRoot();
      valid.should.equal(false);
    });

    it('should get a null hash merkle root', function() {
      var x = Block.fromRawBlock(dataRawBlockBinary);
      x.transactions = []; // empty the txs
      var mr = x.getMerkleRoot();
      mr.should.deep.equal(Block.Values.NULL_HASH);
    });

  });

});
